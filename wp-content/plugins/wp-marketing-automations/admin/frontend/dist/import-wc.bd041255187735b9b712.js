(window.webpackJsonp=window.webpackJsonp||[]).push([[13],{763:function(e,t,r){"use strict";var n=r(0),a=r(35),c=r(2),o=r(758);t.a=function(e){var t=e.selected,r=e.onTagsChange;return Object(n.createElement)("div",{className:"bwf-c-field-mapper-terms"},Object(n.createElement)("div",{className:"bwf-input-label"},Object(c.__)("Add Tags","wp-marketing-automations")),Object(n.createElement)(a.a,{autocompleter:o.b,multiple:!1,allowFreeTextSearch:!0,inlineTags:!1,selected:t,onChange:function(e){r(e)},onRemoveTag:function(e,n){var a=t.filter((function(t){return!(t.key==e&&t.label==n)}));r(a)},placeholder:Object(c.__)("Search by tag name","wp-marketing-automations"),showClearButton:!0,disabled:!1}))}},765:function(e,t,r){"use strict";var n=r(0),a=r(35),c=r(2),o=r(758);t.a=function(e){var t=e.selected,r=e.onListsChange;return Object(n.createElement)("div",{className:"bwf-c-field-mapper-terms"},Object(n.createElement)("div",{className:"bwf-input-label"},Object(c.__)("Add to Lists","wp-marketing-automations")),Object(n.createElement)(a.a,{autocompleter:o.a,multiple:!1,allowFreeTextSearch:!0,inlineTags:!1,selected:t,onChange:function(e){r(e)},onRemoveTag:function(e){var n=t.filter((function(t){return t.key!=e}));r(n)},placeholder:Object(c.__)("Search by list name","wp-marketing-automations"),showClearButton:!0,disabled:!1}))}},771:function(e,t,r){"use strict";r.d(t,"a",(function(){return a}));var n=r(0);var a=function(e,t){var r=Object(n.useRef)();Object(n.useEffect)((function(){r.current=e}),[e]),Object(n.useEffect)((function(){if(null!==t){var e=setInterval((function(){r.current()}),t);return function(){return clearInterval(e)}}}),[t])}},850:function(e,t,r){},936:function(e,t,r){"use strict";r.r(t);var n=r(0),a=r(13),c=r.n(a),o=r(7),i=r(2),s=(r(850),r(4)),l=r(232),m=r(14),u=r(22),b=r(771);function p(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),r.push.apply(r,n)}return r}function f(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?p(Object(r),!0).forEach((function(t){O(e,t,r[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):p(Object(r)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))}))}return e}function O(e,t,r){return t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function j(e,t,r,n,a,c,o){try{var i=e[c](o),s=i.value}catch(e){return void r(e)}i.done?t(s):Promise.resolve(s).then(n,a)}function d(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){if("undefined"==typeof Symbol||!(Symbol.iterator in Object(e)))return;var r=[],n=!0,a=!1,c=void 0;try{for(var o,i=e[Symbol.iterator]();!(n=(o=i.next()).done)&&(r.push(o.value),!t||r.length!==t);n=!0);}catch(e){a=!0,c=e}finally{try{n||null==i.return||i.return()}finally{if(a)throw c}}return r}(e,t)||function(e,t){if(!e)return;if("string"==typeof e)return w(e,t);var r=Object.prototype.toString.call(e).slice(8,-1);"Object"===r&&e.constructor&&(r=e.constructor.name);if("Map"===r||"Set"===r)return Array.from(e);if("Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r))return w(e,t)}(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function w(e,t){(null==t||t>e.length)&&(t=e.length);for(var r=0,n=new Array(t);r<t;r++)n[r]=e[r];return n}var g=function(e){var t=e.importData.importId,r=d(Object(n.useState)(null),2),a=r[0],p=r[1],O=a&&"log"in a?a.log:{},w=O.skipped,g=void 0===w?0:w,v=O.failed,_=void 0===v?0:v,h=O.succeed,E=void 0===h?0:h,y=location&&location.search?Object(u.parse)(location.search.substring(1)):{},k=d(Object(n.useState)(!1),2),N=k[0],S=k[1],I=d(Object(n.useState)(!1),2),C=I[0],x=I[1],T=function(){var e,r=(e=regeneratorRuntime.mark((function e(){var r,n;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,r={start_import:!1,import_id:t},e.next=4,c()({method:"GET",path:Object(o.g)("/import/wc/status?"+Object(u.stringify)(r))});case 4:n=e.sent,p(n.result),n.result&&"status"in n.result&&"success"===n.result.status&&n.result.percent>=100&&(Object(o.w)()||(bwfcrm_contacts_data.first_contact_id=1),S(!0),x(!0)),e.next=12;break;case 9:e.prev=9,e.t0=e.catch(0),setError(e.t0);case 12:case"end":return e.stop()}}),e,null,[[0,9]])})),function(){var t=this,r=arguments;return new Promise((function(n,a){var c=e.apply(t,r);function o(e){j(c,n,a,o,i,"next",e)}function i(e){j(c,n,a,o,i,"throw",e)}o(void 0)}))});return function(){return r.apply(this,arguments)}}();return Object(b.a)((function(){C||T()}),5e3),a?a&&"percent"in a?Object(n.createElement)(n.Fragment,null,Object(n.createElement)("div",{className:"bwf-crm-import-progress-wrap"},Object(n.createElement)("div",{className:"bwf-t-center"},Object(n.createElement)("h2",null,Object(i.__)("Import Progress","wp-marketing-automations")),Object(n.createElement)("div",{className:"bwf-p bwf-p2"},Object(i.__)("Import has begun in the background. We will let you know when it completes.","wp-marketing-automations"))),Object(n.createElement)("div",{className:"bwf_clear_30"}),Object(n.createElement)(l.a,{status:a.status,size:"lg",progress:parseInt(a.percent),text:Object(i.__)("".concat(a.percent,"%"),"wp-marketing-automations")}),Object(n.createElement)("div",{className:"bwf_clear_10"}),Object(n.createElement)("p",null,"Skipped: ",parseInt(g)>0?g:0,", Failed:"," ",parseInt(_)>0?_:0,", Success:"," ",parseInt(E)>0?E:0)),N&&Object(n.createElement)(n.Fragment,null,Object(n.createElement)("div",{className:"bwf-crm-importer-back-button"},Object(n.createElement)(s.Button,{className:"bwf-crm-navigation-back",isPrimary:!0,onClick:function(){Object(m.j)(f(f({},y),{},{path:"/contacts"}),"/contacts",y)}},Object(i.__)("Go To Contacts","wp-marketing-automations")),!!a&&!!a.has_log_file&&Object(n.createElement)("a",{target:"_blank",href:"/wp-json"+Object(o.g)("/importer-log/download/".concat(t,"?bwf-nonce=").concat(Object(o.i)())),title:"Download",className:"bwf-a-no-underline",style:{marginLeft:"10px"},rel:"noreferrer"},Object(n.createElement)(s.Button,{isSecondary:!0},Object(i.__)("Download Error Log","wp-marketing-automations")))))):null:Object(n.createElement)(n.Fragment,null,Object(n.createElement)("div",{className:"bwf-crm-import-progress-wrap"},Object(n.createElement)("div",{className:"bwf-t-center"},Object(n.createElement)("h2",null,Object(i.__)("Import Progress","wp-marketing-automations")),Object(n.createElement)("div",{className:"bwf-p bwf-p2"},Object(i.__)("Import has begun in the background. We will let you know when it completes.","wp-marketing-automations"))),Object(n.createElement)("div",{className:"bwf_clear_30"}),Object(n.createElement)(l.a,{status:"info",size:"lg",progress:0,text:Object(i.__)("0%","wp-marketing-automations")}),Object(n.createElement)("div",{className:"bwf_clear_10"}),Object(n.createElement)("div",{className:"bwf-p"},"Skipped: ",parseInt(g)>0?g:0,", Failed: ",parseInt(_)>0?_:0,", Success: ",parseInt(E)>0?E:0)))},v=r(3),_=r(763),h=r(765),E=r(781),y=r(34),k=r(79);r(12);function N(e,t,r,n,a,c,o){try{var i=e[c](o),s=i.value}catch(e){return void r(e)}i.done?t(s):Promise.resolve(s).then(n,a)}function S(e){return function(){var t=this,r=arguments;return new Promise((function(n,a){var c=e.apply(t,r);function o(e){N(c,n,a,o,i,"next",e)}function i(e){N(c,n,a,o,i,"throw",e)}o(void 0)}))}}function I(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){if("undefined"==typeof Symbol||!(Symbol.iterator in Object(e)))return;var r=[],n=!0,a=!1,c=void 0;try{for(var o,i=e[Symbol.iterator]();!(n=(o=i.next()).done)&&(r.push(o.value),!t||r.length!==t);n=!0);}catch(e){a=!0,c=e}finally{try{n||null==i.return||i.return()}finally{if(a)throw c}}return r}(e,t)||function(e,t){if(!e)return;if("string"==typeof e)return C(e,t);var r=Object.prototype.toString.call(e).slice(8,-1);"Object"===r&&e.constructor&&(r=e.constructor.name);if("Map"===r||"Set"===r)return Array.from(e);if("Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r))return C(e,t)}(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function C(e,t){(null==t||t>e.length)&&(t=e.length);for(var r=0,n=new Array(t);r<t;r++)n[r]=e[r];return n}t.default=function(e){Object(o.d)("WC Importer");var t=e.step,r=I(Object(n.useState)({}),2),a=r[0],l=r[1],m=I(Object(n.useState)(!0),2),b=m[0],p=m[1],f=I(Object(n.useState)(null),2),O=f[0],j=f[1],d=I(Object(n.useState)(!1),2),w=d[0],N=d[1],C=I(Object(n.useState)(!0),2),x=C[0],T=(C[1],I(Object(n.useState)(!1),2)),P=T[0],A=T[1],F=I(Object(n.useState)([]),2),R=F[0],B=F[1],D=I(Object(n.useState)([]),2),L=D[0],U=D[1],W=Object(n.useContext)(o.b),G=I(Object(n.useState)(1),2),z=G[0],J=G[1],M=(0,Object(E.a)().getExistingImports)().wc,$={0:Object(i.__)("Unverified","wp-marketing-automation-crm"),1:Object(i.__)("Subscribed","wp-marketing-automation-crm"),2:Object(i.__)("Bounced","wp-marketing-automation-crm"),3:Object(i.__)("Unsubscribed","wp-marketing-automation-crm")},Q=function(){var t=S(regeneratorRuntime.mark((function t(){var r,n,a,s=arguments;return regeneratorRuntime.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return r=s.length>0&&void 0!==s[0]&&s[0],t.prev=1,n={start_import:r,tags:R.map((function(e){return{id:e.key,value:e.label}})),lists:L.map((function(e){return{id:e.key,value:e.label}})),marketing_status:x,update_existing:P,disable_events:w,imported_contact_status:z},t.next=5,c()({method:"GET",path:Object(o.g)("/import/wc/status?"+Object(u.stringify)(n))});case 5:a=t.sent,l({importId:a.result.import_id}),e.setStep(3),t.next=14;break;case 10:t.prev=10,t.t0=t.catch(1),l(null),W(t.t0&&"message"in t.t0?t.t0.message:Object(i.__)("There are some technical difficulties while processing CSV Import","wp-marketing-automations"));case 14:Object(o.Q)(W,2e3),p(!1);case 16:case"end":return t.stop()}}),t,null,[[1,10]])})));return function(){return t.apply(this,arguments)}}(),V=function(){var e=S(regeneratorRuntime.mark((function e(){return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,c()({method:"GET",path:Object(o.g)("/import/wc/get-orders")}).then((function(e){j(parseInt(e.result)),p(!1)}));case 2:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}();Object(n.useEffect)((function(){parseInt(M)>0?(l({importId:M}),p(!1)):V()}),[]);return Object(n.createElement)("div",{className:"bwf-crm-importer-wrap"},2==t&&b&&(Object(v.isEmpty)(a)||1===a.status)&&Object(n.createElement)(y.a,null),2==t&&!b&&!Object(v.isNull)(O)&&(O>0?Object(n.createElement)(n.Fragment,null,Object(n.createElement)(k.a,null),Object(n.createElement)("div",{className:"bwf-card-wrap"},Object(n.createElement)("div",{className:"bwf-card-header bwf-h4"},Object(i.__)("Configuration","wp-marketing-automations"))),Object(n.createElement)("div",{className:"bwf-crm-importer-wc-wrap"},Object(n.createElement)("div",{className:"bwf-crm-import-section bwf-t-center"},Object(n.createElement)("div",{className:"bwf-h3"},Object(i.__)("WooCommerce Customers","wp-marketing-automations")),Object(n.createElement)("div",{className:"bwf_clear_20"}),Object(n.createElement)("div",{className:"bwf-p bwf-p2"},O+" "+Object(i.__)("paid orders are available for import.","wp-marketing-automations"))),Object(n.createElement)("div",{className:"bwf-crm-import-section"},Object(n.createElement)("div",{className:"bwf-h3"},Object(i.__)("Contact Profile","wp-marketing-automations")),Object(n.createElement)("div",{className:"bwf_clear_20"}),Object(n.createElement)("div",{className:"bwf-c-import-field"},Object(n.createElement)(_.a,{onTagsChange:B,selected:R}),Object(n.createElement)(h.a,{onListsChange:U,selected:L})),Object(n.createElement)("div",{className:"bwf_clear_10"}),Object(n.createElement)("div",{className:"bwf-p"},Object(i.__)("Status","wp-marketing-automations")),Object(n.createElement)("select",{className:"bwf-import-wc-status-select",onChange:function(e){J(e.target.value)}},Object.keys($).map((function(e){return Object(n.createElement)("option",{key:e,value:e,selected:z==e},$[e])}))),Object(n.createElement)("div",{className:"bwf_clear_20"}),Object(n.createElement)(s.ToggleControl,{checked:P,label:Object(i.__)("Update existing contact status","wp-marketing-automations"),className:"bwf-tooglecontrol-advance",onChange:function(e){return A(e)}}),Object(n.createElement)(s.ToggleControl,{label:Object(i.__)("Trigger Automations (for Tag & List related Events)","wp-marketing-automations"),className:"bwf-tooglecontrol-advance",checked:w,onChange:N})),Object(n.createElement)("div",{className:"bwf_clear_20"}),Object(n.createElement)("div",{className:"bwf-crm-btn-right-alignment"},Object(n.createElement)(s.Button,{className:"bwf-crm-navigation-back",isPrimary:!0,onClick:function(){e.setStep(3),p(!0),Q(!0)}},Object(i.__)("Import","wp-marketing-automations"))))):Object(n.createElement)(n.Fragment,null,Object(n.createElement)(k.a,null),Object(n.createElement)("div",{className:"bwf-crm-importer-wc-wrap"},Object(n.createElement)("div",{className:"bwf-crm-import-section bwf-t-center"},Object(n.createElement)("div",{className:"bwf-h3"},Object(i.__)("WooCommerce Customers","wp-marketing-automations")),Object(n.createElement)("div",{className:"bwf_clear_20"}),Object(n.createElement)("div",{className:"bwf-p bwf-p2"},Object(i.__)("No Orders are available for import.","wp-marketing-automations"))),Object(n.createElement)("div",{className:"bwf_clear_20"})))),2==t&&!b&&Object(n.createElement)("div",{className:"bwf-crm-importer-navigation"},Object(n.createElement)(s.Button,{className:"bwf-crm-navigation-back bwf-display-flex",isSecondary:!0,onClick:function(){e.setStep(1),e.setImporter(null)}},Object(n.createElement)("span",null,Object(i.__)("Back","wp-marketing-automations")))),3==t&&b&&Object(n.createElement)(y.a,null),3==t&&!b&&a&&Object(n.createElement)(n.Fragment,null,Object(n.createElement)(k.a,null),Object(n.createElement)("div",{className:"bwf-card-wrap"},Object(n.createElement)("div",{className:"bwf-card-header bwf-h4"},Object(i.__)("Configuration","wp-marketing-automations"))),Object(n.createElement)(g,{importData:a,setStep:e.setStep,setImporter:e.setImporter})))}}}]);