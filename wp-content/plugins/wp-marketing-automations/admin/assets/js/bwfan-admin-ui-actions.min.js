"use strict";var BWFAN_Actions,bwfan_select2_ajax_data=window.bwfan_set_select2ajax_js_data;!function(t){(BWFAN_Actions={init:function(){this.dom_ready(),this.win_load(),this.dom_click()},dom_ready:function(){t(document).ready(function(){t(document).on("bwfan_trigger_modified",function(){t("#bwfan-source-events").html(""),!0===_.isUndefined(BWFAN_Auto.uiDataDetail.trigger.event)?BWFAN_Actions.create_event_ui(!0):BWFAN_Actions.create_event_ui(!1)}),t(document).on("bwfan_action_modified",function(t,e,a){BWFAN_Auto.emptySidebar(),BWFAN_Actions.build_right_ui(e,a);var n=bwfanParams.events_merge_tags;n=n[BWFAN_Auto.uiDataDetail.trigger.event],BWFAN_Actions.make_merge_tag_ui(BWFAN_Auto.uiDataDetail.trigger.event,n)}),t(document).on("submit","#bwfan-events-form-container",function(e){if(!1===BWFAN_Auto.is_event_exists())return swal({title:window.bwfan.texts.sync_oops_title,text:window.bwfan.texts.no_event,type:"error"}),void e.preventDefault();var a=!1,n=[],i=[];for(var o in t(".bwfan-checkbox").each(function(){var e=t(this).attr("name"),a=t(this).attr("data-warning");n.push(e),i.push(a)}),t.unique(n),t.unique(i),n)if(0==t('[name="'+n[o]+'"]:checked').length)return swal({type:"error",title:window.bwfan.texts.sync_oops_title,text:i[o]}),a=!0,!1;if(a)return console.log("checkbox not checked"),!1;var r=t(this).bwfan_serializeAndEncode();r=bwfan_deserialize_obj(r),BWFAN_Auto.setTriggerData("",r);var s=bwfan_automation_data.all_triggers_events,l=BWFAN_Auto.uiDataDetail.trigger.source,c=BWFAN_Auto.uiDataDetail.trigger.event,d=BWFAN_Actions.get_action_name("event_text",l,c);if(BWFAN_Auto.setTriggerData("name",d),bwfan_automation_data.is_time_independent=s[l][c].is_time_independent,_.size(BWFAN_Auto.uiData)<2){BWFAN_Auto.uiData[0].html=["gap"],BWFAN_Auto.uiData.push({id:"else",mode:"0",html:["end_html"]});var u=wp.template("bwfan-sidebar-top"),f=BWFAN_Auto.getSidebarTopTextArr("select_block");BWFAN_Auto.rightElemTop.html(u(f))}return t('.item_wrap[data-group-id="'+r.bwfan_group_id+'"] .bwfan-select-action[data-group-id="'+r.bwfan_action_id+'"]').attr("data-filled",1),BWFAN_Auto.buildAutomation(),t(document).trigger("bwfan_automation_save"),!1}),t(document).on("submit","#bwfan-actions-form-container",function(){var e=t(this).bwfan_serializeAndEncode(),a=(e=bwfan_deserialize_obj(e)).bwfan[e.bwfan_action_id],n=a.integration_slug,i=a.action_slug,o=BWFAN_Actions.get_action_name("action_text",n,i),r="";if(_.has(a,"time")&&_.has(a.time,"delay_type")&&"immediately"!==a.time.delay_type){var s=BWFAN_Actions.get_action_timer_ui(a.time);r='<div class="item_single_icon_timer"><img src="'+adminImgPath+'timer.svg"/> Delay ('+s+")</div>"}var l="";"wp_sendemail"===i&&_.has(a,"data")&&_.has(a.data,"subject")&&""!=a.data.subject&&(l="<div class='item_single_icon_email'><img src='"+adminImgPath+"email.svg'/><span>"+a.data.subject+"</span></div>");var c='<div class="bwfan_small_name">'+o.integration+"</div><div>"+o.action+"</div>"+r+l+"</div>",d=BWFAN_Actions.get_action_name("action",n,i);BWFAN_Actions.get_action_name("integration",n,i);a.action_name=o;var u=BWFAN_Auto.getActionData(e.bwfan_group_id,e.bwfan_action_id);return _.has(u,"ajax-data")&&(a["ajax-data"]=u["ajax-data"]),d&&(t('.workflow_item[data-group="'+e.bwfan_group_id+'"] .item_modify_action[data-action="'+e.bwfan_action_id+'"] .action_text').html(c),t('.workflow_item[data-group="'+e.bwfan_group_id+'"] .item_modify_action[data-action="'+e.bwfan_action_id+'"] .bwfan_hide_hard').removeClass("bwfan_hide_hard")),BWFAN_Auto.setActionData(e.bwfan_group_id,e.bwfan_action_id,a),t('.item_wrap[data-group-id="'+e.bwfan_group_id+'"] .bwfan-select-action[data-group-id="'+e.bwfan_action_id+'"]').attr("data-filled",1),t(document).trigger("bwfan_automation_save"),!1}),t(document).on("bwfan_automation_save",function(e){if(!0!==_.isUndefined(BWFAN_Auto)){if(!1===BWFAN_Auto.is_event_exists())return swal({title:window.bwfan.texts.sync_oops_title,text:window.bwfan.texts.no_event,type:"error"}),void e.preventDefault();if("on"==bwfan_automation_data.automation_sync_state)return swal({title:window.bwfan.texts.sync_oops_title,text:window.bwfan.texts.sync_process_oops_title,type:"error"}),void e.preventDefault();if(!0===_.isUndefined(BWFAN_Auto.uiDataDetail.trigger.name))return swal({type:"error",title:window.bwfan.texts.sync_oops_title,text:window.bwfan.texts.no_trigger}),!1;var a=t(".bwfan-manage-automation-form"),n=t(a).serializeArray(),i=!1;t(n).each(function(t,e){var a=e.value;if(null!=a&&"-1"==e.name.indexOf("ajax_data")){if(0==(i=BWFAN_Actions.validate_merge_tags_syntax(a)))return i=!0,!1;i=!1}});var o=!1,r=[],s=[];for(var l in t(".bwfan-checkbox").each(function(){var e=t(this).attr("name"),a=t(this).attr("data-warning");r.push(e),s.push(a)}),t.unique(r),t.unique(s),r)if(0==t('[name="'+r[l]+'"]:checked').length)return swal({type:"error",title:window.bwfan.texts.sync_oops_title,text:s[l]}),o=!0,!1;if(o)return console.log("checkbox not checked"),!1;i?swal({type:"error",title:window.bwfan.texts.merge_tag_error_title,text:window.bwfan.texts.merge_tag_error_text}):a[0].checkValidity()?a.trigger("submit"):a.find(":submit").click()}});var e=new bwf_ajax(".bwfan-manage-automation-form",!0);e.data=function(t){var e=JSON.stringify(BWFAN_Auto.uiDataDetail);return e=e.replaceAll("(!IE)","!(IE)"),t.append("data",e),t.append("ui",JSON.stringify(BWFAN_Auto.ui)),t.append("uiData",JSON.stringify(BWFAN_Auto.uiData)),t},e.success=function(a){var n=e.element(),i=t(n);1==a.status?i.find("input[name=t_to_delete]").val(""):swal({type:"error",title:window.bwfan.texts.sync_oops_title,text:a.msg})},t(document).on("change",".bwfan-selected-source",function(){var e=t(this).val();t("#bwfan-source-events").html(""),""===e&&(BWFAN_Auto.setBlankUI(),BWFAN_Auto.setBlankUIDetail());var a=bwfan_automation_data.all_sources_events[e];a=a.events;var n=!1;!1===_.has(BWFAN_Auto.uiDataDetail.trigger,"source")&&(n=!0),!1!==_.has(BWFAN_Auto.uiDataDetail.trigger,"source")&&e!=BWFAN_Auto.uiDataDetail.trigger.source?swal({title:"",text:window.bwfan.texts.source_change,type:"warning",showCancelButton:!0,confirmButtonColor:"#DD6B55",confirmButtonText:"Yes, proceed.",cancelButtonText:"No, Revert.",allowOutsideClick:!1}).then(function(n){n&&(console.log("yes"),BWFAN_Auto.setBlankData(),BWFAN_Auto.emptySidebar(),BWFAN_Auto.uiData.push({id:"trigger",html:{}}),BWFAN_Auto.buildAutomation(),t(document).trigger("bwfan_trigger_modified"),BWFAN_Actions.set_source_val(e),BWFAN_Actions.bwfan_set_events_new(!0,a))}).catch(function(){console.log("no"),t(".bwfan-selected-source").val(BWFAN_Auto.uiDataDetail.trigger.source),BWFAN_Actions.create_event_ui(!1)}):BWFAN_Actions.bwfan_set_events_new(n,a)}),t(document).on("keyup",".search_merge_tag",function(){var e=t(this).val();e=e.toLowerCase(),t(".bwfan-table-merge-tags tr").each(function(){var a=t(this),n=a.find("td:first").text();n=n.toLowerCase();var i=a.find("td:first span.bwfan-merge-tag-desc").text();i=i.toLowerCase();var o=n.includes(e),r=i.includes(e);o||r?a.show():a.hide()})}),t(document).on("change",".bwfan-selected-trigger",function(){var e=t(this),a=e.val(),n=e.attr("data-old");if(""===a)return BWFAN_Auto.setup_cancelled_elements(e,{selected_value:a,old_value:n,events_merge_tags:i}),BWFAN_Auto.show_prompt_before_delete(window.bwfan.texts.change_event_title,window.bwfan.texts.change_event_text,"bwfan_modify_event","Yes! delete all actions","Do nothing"),t("#bwfan-section-merge-tags").html('<h3 class="bwfan-text-center">Please Select An Event</h3>'),void t(".bwfan-events-meta").html("");var i=bwfanParams.events_merge_tags;if(i=i[a],!1===_.isUndefined(BWFAN_Auto.uiDataDetail.trigger.event)&&BWFAN_Auto.uiDataDetail.trigger.event!=a)return BWFAN_Auto.setup_cancelled_elements(e,{selected_value:a,old_value:n,events_merge_tags:i}),BWFAN_Auto.show_prompt_before_delete(window.bwfan.texts.change_event_title,window.bwfan.texts.change_event_text,"bwfan_modify_event","Yes! delete all actions","Do nothing"),!1;BWFAN_Actions.make_merge_tag_ui(a,i),t("#tmpl-event-"+a).length>0?BWFAN_Actions.create_event_meta_ui(a):t(".bwfan-events-meta").html("")}),t(document).on("focus",".bwfan-selected-trigger",function(){var e=t(this),a=e.val();""!==a&&e.attr("data-old",a)}),t(document).on("change",".bwfan-delay-types",function(){var e=t(this);BWFAN_Actions.create_execution_delay_time_ui(e),t(".bwfan-delay-options-container").hide(),"immediately"===e.val()||t(".bwfan_time_"+e.val()).show()}),t(document).on("change","#scheduled_time_check",function(){var e=t(this);t("#scheduled_time_check:checked").length?e.parent().siblings("div").removeClass("bwfan-display-none"):e.parent().siblings("div").addClass("bwfan-display-none")}),t(document).on("change","#scheduled_days_check",function(){var e=t(this);t("#scheduled_days_check:checked").length?e.parent().siblings("div").removeClass("bwfan-display-none"):e.parent().siblings("div").addClass("bwfan-display-none")}),t(document).on("change",".bwfan_time_number",function(){var e=t(this);BWFAN_Actions.create_execution_delay_time_ui(e)}),t(document).on("change",".bwfan-delay-mode",function(){var e=t(this);BWFAN_Actions.create_execution_delay_time_ui(e)}),t(document).on("change",".bwfan_fixed_date",function(){var e=t(this);BWFAN_Actions.create_execution_delay_time_ui(e)}),t(document).on("change",".bwfan_fixed_time",function(){var e=t(this);BWFAN_Actions.create_execution_delay_time_ui(e)}),t(document).on("keyup change paste","#bwfan-actions-form-container input, #bwfan-actions-form-container select, #bwfan-actions-form-container textarea",function(){var e=t("#bwfan-actions-form-container").bwfan_serializeAndEncode();e=bwfan_deserialize_obj(e);var a=parseInt(e.bwfan_group_id),n=parseInt(e.bwfan_action_id),i=e.bwfan[n],o=i.integration_slug,r=i.action_slug,s=BWFAN_Actions.get_action_name("action_text",o,r);i.action_name=s,BWFAN_Auto.setActionData(a,n,i)});var a="undefined"!=typeof automationEventActionData?automationEventActionData:{},n=a&&a.hasOwnProperty("woocommerce_enable")&&a.woocommerce_enable?"wc":"wp",i=n,o="messaging",r="all",s="",l="",c="",d="",u=a.groupdata,f=a.source_event,g=a.actions,m=a.integration_list,w=a.integration_group,b=a.templates,p=a.link_triggers,v=a.siteurl;if(t("#modal-autonami-link-trigger-selector").length>0){t("#modal-autonami-link-trigger-selector").iziModal({width:786,radius:5,padding:0,background:"rgb(255, 255, 255)",overlayColor:"rgba(0, 0, 0, 0.6)",zindex:9999999,transitionIn:"none",onOpening:function(){d="",t("#modal-search-link-trigger-field").val(""),h()}}),t("#bwfan-modal-link-trigger-content").on("click",".bwf-link-trigger-item-copy",function(e){var a=this.getAttribute("data-url");if(""!==a){var n=document.createElement("textarea");n.value=a,document.body.appendChild(n),n.select(),document.execCommand("copy"),document.body.removeChild(n);var i=t("#modal_automation_success");i.length>0&&(i.iziModal("setTitle","Link copied"),i.iziModal("open"))}}),t("#modal-search-link-trigger-field").length>0&&t("#modal-search-link-trigger-field").on("keyup",function(){d=this.value,h()});var h=function(){var e="";if(p.length>0){e='<div class="bwf-link-trigger-modal-table-wrapper"><table class="bwf-link-trigger-list-table"><tbody>';var a=!1;p.map(function(t){if(""==d||-1!=t.title.toLowerCase().indexOf(d.toLowerCase())){var n=t.title?t.title:"-",i=t.hasOwnProperty("desc")?t.desc:"-",o="";t.hasOwnProperty("hash")&&(o=v+"/?bwfan-link-trigger="+t.hash);var r="-";t.hasOwnProperty("actions")&&t.actions.length>0&&(1==t.actions.length?r=t.actions[0]:(r=" <div class='view-more-list'> "+t.actions[0]+" <div class='list-wrapper'> <div class='icon-wrap'>+"+(t.actions.length-1)+'<span class="dashicons dashicons-arrow-down-alt2"></span></div> <ul>',t.actions.map(function(t){r+="<li>"+t+"</li>"}),r+="</ul></div></div>")),e+='<tr><td><span class="bwf-link-trigger-title">'+n+'</span><span class="bwf-link-trigger-desc">'+i+"</span></td><td>"+r+'</td><td><div class="bwf-link-trigger-action-wrap"><span class="bwf-link-trigger-item-copy" data-url="'+o+'">Copy</span></div></td></tr>',a=!0}}),e+="</tbody></table></div>",a||(e="")}""===e&&(e+='<p class="empty-result">No Link Triggers Found!</p>'),t("#modal-autonami-link-trigger-selector .bwfan-search-filter-modal-wrap #bwfan-modal-link-trigger-content").html(e)}}t("#modal-autonami-template-selector").length>0&&t("#modal-autonami-template-selector").iziModal({width:786,radius:5,padding:0,background:"rgb(255, 255, 255)",overlayColor:"rgba(0, 0, 0, 0.6)",zindex:9999999,transitionIn:"none",onOpening:function(){r="all",c="",t("#modal-search-template-field").val(""),t("#modal-autonami-template-selector .bwfan-widget-checkbox-wrap .bwfan-widget-filter").eq(0).prop("checked",!0),A()}}),t("#bwfan-modal-template-content").on("click",".bwf-template-item-apply",function(e){var a=function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,e={};return 0!=t&&b.map(function(a){a.ID==t&&(e=a)}),e}(t(this).data("id"));if(a&&a.template&&a.mode){var n=window.richAutomationEditor,i=t("#bwfan-raw_textarea"),o=t("#bwfan-editor-body"),r=t("#bwfan-editor-design");switch(t("#bwfan_email_subject").val(a.subject),parseInt(a.mode)){case 1:if(!n)return;n.setContent(a.template),tinymce.triggerSave(),jQuery('.bwfan_email_template[value="raw_template"]').next().trigger("click");break;case 3:if(!i)return;i.val(a.template),jQuery('.bwfan_email_template[value="raw"]').next().trigger("click");break;case 4:if(!o)return;o.val(a.template),a.data.design&&r.val(a.data.design),jQuery('.bwfan_email_template[value="editor"]').next().trigger("click")}var s=!(!a.data||!a.data.utmEnabled)&&a.data.utmEnabled,l=!(!a.data||!a.data.utm)&&a.data.utm;!0===s?(document.getElementById("bwfan_append_utm").checked=!0,t("#bwfan_append_utm").trigger("change"),t("#bwfan_utm_source").val(l.source),t("#bwfan_utm_medium").val(l.medium),t("#bwfan_utm_term").val(l.term),t("#bwfan_utm_campaign").val(l.name)):(document.getElementById("bwfan_append_utm").checked=!1,t("#bwfan_append_utm").trigger("change")),t("#modal-autonami-template-selector").iziModal("close")}});var A=function(){var e="",a=["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"];if(b.length>0){e='<div class="bwf-template-modal-table-wrapper"><table class="bwf-template-list-table"><tbody>';var n=!1;b.map(function(t){if(parseInt(r)==parseInt(t.mode)||"all"==r)if(""!=c&&-1==t.title.toLowerCase().indexOf(c.toLowerCase()));else{var i=t.title?t.title:"-",o=t.subject?t.subject:"-",s=new Date(t.created_at),l=a[s.getMonth()]+" "+s.getDay()+", "+s.getFullYear();e+='<tr><td><span class="bwf-template-title">'+i+'</span><span class="bwf-template-create-detail bwf-subject">Subject  : '+o+'</span><span class="bwf-template-create-detail">Created on : '+l+'</span></td><td><div class="bwf-template-action-wrap"><span class="bwf-template-item-apply" data-id="'+t.ID+'">Apply</span></div></td></tr>',n=!0}}),e+="</tbody></table></div>",n||(e="")}""===e&&(e+='<p class="empty-result">No Template Found!</p>'),t("#modal-autonami-template-selector .bwfan-search-filter-modal-wrap #bwfan-modal-template-content").html(e)};if(t("#modal-search-template-field").length>0&&t("#modal-search-template-field").on("keyup",function(){(c=this.value).length>0&&(t("#modal-autonami-template-selector input[name='widget_filter'][value='all']").prop("checked",!0),r="all"),A()}),t("#modal-autonami-template-selector .bwfan-widget-checkbox-wrap .bwfan-widget-filter").length>0&&t("#modal-autonami-template-selector .bwfan-widget-checkbox-wrap .bwfan-widget-filter").on("click touch",function(){t(this).hasClass("is-selected")||t(this).hasClass("is-selected")||(t("#modal-autonami-template-selector .bwfan-widget-checkbox-wrap .bwfan-widget-filter").removeClass("is-selected"),t(this).addClass("is-selected"),r=t(this).val()),A()}),t("#modal-autonami-event").length>0&&t("#modal-autonami-event").iziModal({width:786,radius:5,padding:0,background:"rgb(255, 255, 255)",overlayColor:"rgba(0, 0, 0, 0.6)",zindex:9999999,transitionIn:"none",onOpening:function(){s="",i=n,t("#modal-autonami-event .bwfan-search-filter-modal-wrap #modal-search-field").val(""),t("#modal-autonami-event input[name='widget_filter'][value='"+n+"']").prop("checked",!0),y()}}),t("#modal-autonami-event .bwfan-widget-checkbox-wrap .bwfan-widget-filter").length>0&&t("#modal-autonami-event .bwfan-widget-checkbox-wrap .bwfan-widget-filter").on("click touch",function(){t(this).hasClass("is-selected")||(t("#modal-autonami-event .bwfan-widget-checkbox-wrap .bwfan-widget-filter").removeClass("is-selected"),t(this).addClass("is-selected"),i=t(this).val()),y()}),t("#bwfanAutomationEvents").length>0){t("#modal-autonami-event .bwfan-search-filter-modal-wrap #modal-search-field").length>0&&t("#modal-autonami-event .bwfan-search-filter-modal-wrap #modal-search-field").on("keyup",function(){(s=this.value).length>0?(t("#modal-autonami-event .bwfan-widget-checkbox-wrap .bwfan-widget-filter").removeClass("is-selected"),t("#bwf-event-search-row").show(),i="all",t("#bwf-event-search-row .bwfan-widget-filter").addClass("is-selected").prop("checked",!0)):(i=n,t("#modal-autonami-event input[name='widget_filter'][value='"+n+"']").prop("checked",!0),t("#bwf-event-search-row").hide()),y()});var y=function(){var e="";u[i].subgroup.forEach(function(t){if(f.hasOwnProperty(t)){var a=f[t].events,n=g[t];for(var i in a){var o='<div class="modal-brick-wrap bwfan_pb20"> <div class="brick-title bwfan_mb5">{{label}}</div> <div class="brick-content">'.replace(/{{label}}/g,i.toUpperCase()),r=0;for(var l in a[i]){var c=n[l];""!=s&&-1==c.event_name.toLowerCase().indexOf(s.toLowerCase())||(o+='<div class="bwf-event-brick button button-secondary bwfan_button_alter fixed_button" data-value="{{value}}" data-group="{{group}}">{{label}}</div>'.replace(/{{label}}/g,c.event_name).replace(/{{value}}/g,c.slug).replace(/{{group}}/g,t),r++)}0!=r&&(e+=o+"</div></div>")}}}),""==e&&(e='<p class="empty-result">No Event Found!</p>',t("#bwf-modal-event-continue").attr("disabled",!0),{}),t("#modal-autonami-event .bwfan-search-filter-modal-wrap #bwfan-modal-content-content").html(e)};t(document).on("click","#modal-autonami-event .bwf-event-brick",function(){({group:t(this).attr("data-group"),id:t(this).attr("data-value")}),t(this).hasClass("is-selected")?(t(".bwf-event-brick").removeClass("is-selected"),t("#bwf-modal-event-continue").attr("disabled",!0),{}):(t(".bwf-event-brick").removeClass("is-selected"),t("#bwf-modal-event-continue").removeAttr("disabled"),t(this).addClass("is-selected"))})}t("#modal-autonami-event-action").length>0&&t("#modal-autonami-event-action").iziModal({width:786,radius:5,padding:0,background:"rgb(255, 255, 255)",overlayColor:"rgba(0, 0, 0, 0.6)",zindex:9999999,transitionIn:"none",onOpening:function(){l="",t("#bwf-action-search-row").hide(),t("#modal-autonami-event-action .bwfan-search-filter-modal-wrap #modal-search-action-field").val(""),t("#modal-autonami-event-action label.bwfan-widget-checkbox-wrap").eq(1).find("input[name='widget_filter']").trigger("click")}}),t("#modal-autonami-event-action .bwfan-widget-checkbox-wrap .bwfan-widget-filter").length>0&&t("#modal-autonami-event-action .bwfan-widget-checkbox-wrap .bwfan-widget-filter").on("click touch",function(){t(this).hasClass("is-selected")||t(this).hasClass("is-selected")||(t("#modal-autonami-event-action .bwfan-widget-checkbox-wrap .bwfan-widget-filter").removeClass("is-selected"),t(this).addClass("is-selected"),o=t(this).val()),x()}),t("#modal-autonami-event-action .bwfan-search-filter-modal-wrap #modal-search-action-field").length>0&&t("#modal-autonami-event-action .bwfan-search-filter-modal-wrap #modal-search-action-field").on("keyup",function(){(l=this.value).length>0?(t("#modal-autonami-event-action .bwfan-widget-checkbox-wrap .bwfan-widget-filter").removeClass("is-selected"),t("#bwf-action-search-row").show(),o="all",t("#bwf-action-search-row .bwfan-widget-filter").addClass("is-selected").prop("checked",!0)):(o=t("#modal-autonami-event-action label.bwfan-widget-checkbox-wrap").eq(1).find("input[name='widget_filter']").val(),t("#modal-autonami-event-action label.bwfan-widget-checkbox-wrap").eq(1).find("input[name='widget_filter']").prop("checked",!0),t("#bwf-action-search-row").hide()),x()});var x=function(){var e="",a=BWFAN_Auto.uiDataDetail.trigger.event,n=w[o].subgroup;for(var i in n){var r=m[i],s='<div class="modal-brick-wrap bwfan_pb20"> <div class="brick-title bwfan_mb5">{{label}}</div> <div class="brick-content">'.replace(/{{label}}/g,n[i].toUpperCase()),c=0;for(var d in r){var u=r[d],f=!1,g=_.has(u,"real_integration")?u.real_integration:i;u.included_events.length>0?u.included_events.includes(a)&&(f=!0):u.excluded_events.length>0&&u.excluded_events.includes(a)||(f=!0),""!=l&&-1==u.action_name.toLowerCase().indexOf(l.toLowerCase())||!f||(s+='<div class="bwf-event-brick button button-secondary bwfan_button_alter fixed_button" data-value="{{value}}" data-group="{{group}}">{{label}}</div>'.replace(/{{label}}/g,u.action_name).replace(/{{value}}/g,u.slug).replace(/{{group}}/g,g),c++)}0!=c&&(e+=s+"</div></div>")}""===e&&(e+='<p class="empty-result">No Action Found!</p>'),t("#modal-autonami-event-action .bwfan-search-filter-modal-wrap #bwfan-modal-content-content").html(e)}});t(document).on("click","#modal-autonami-event-action .bwf-event-brick",function(){({group:t(this).attr("data-group"),id:t(this).attr("data-value")}),t(this).hasClass("is-selected")?(t("#modal-autonami-event-action .bwf-event-brick").removeClass("is-selected"),t("#bwf-modal-action-continue").attr("disabled",!0),{}):(t("#modal-autonami-event-action .bwf-event-brick").removeClass("is-selected"),t("#bwf-modal-action-continue").removeAttr("disabled"),t(this).addClass("is-selected"))})},win_load:function(){t(window).on("bind","load",function(){var e;if("undefined"!=typeof BWFAN_Auto&&!1===_.isUndefined(BWFAN_Auto.uiDataDetail.trigger)&&(e=(e=bwfanParams.events_merge_tags)[BWFAN_Auto.uiDataDetail.trigger.event],BWFAN_Actions.make_merge_tag_ui(BWFAN_Auto.uiDataDetail.trigger.event,e)),t(".bwfan-selected-trigger").length>0){var a=t(".bwfan-selected-trigger").val();""!==a&&(e=(e=bwfanParams.events_merge_tags)[a],BWFAN_Actions.make_merge_tag_ui(a,e))}})},dom_click:function(){var e="";t(document).on("click",".bwfan-selected-merge-tag",function(){var a=t("#modal-show-merge-tags h2.iziModal-header-title");e=a.text();var n=t(this).attr("data-class"),i="#tmpl-"+t(this).attr("data-class"),o=t(i).attr("data-tag");a.html('<span class="dashicons dashicons-arrow-left-alt bwfan_back_merge_tags" title="Back"></span>'+o),t(".bwfan-merge-tag-list").hide();var r=wp.template(n);if(bwfan_make_html(1,"#bwfan-merge-tag-settings",r()),t(".bwfan-preview-merge-tag").val("{{"+o+"}}"),t(".bwfan_inner_merge_tag_desc").html(t(".desc_"+n).html()),t("#bwfan-merge-tag-settings").attr("merge-tag",o),t(".bwfan-select2ajax-single").length>0){var s=t(".bwfan-select2ajax-single").attr("data-search"),l=t(".bwfan-select2ajax-single").attr("data-search-text");BWFAN_Actions.initiate_select2_ajax_single(".bwfan-select2ajax-single",l,s)}t("body").trigger("bwfan-selected-merge-tag",{tag:o})}),t(document).on("click",".bwfan_back_merge_tags",function(){t("#bwfan-merge-tag-settings").html("");var a=t("#modal-show-merge-tags h2.iziModal-header-title");a.text(e),a.css("padding-left","0px"),t(".bwfan-merge-tag-list").show()}),t(document).on("change",".bwfan_tag_select",function(){BWFAN_Actions.create_merge_tag_code()}),t(document).on("change","#add_recovery_url_coupon",function(){"yes"===t(this).val()?t(this).closest(".bwfan_mtag_wrap").siblings(".bwfan_mtag_wrap").show():t(this).closest(".bwfan_mtag_wrap").siblings(".bwfan_mtag_wrap").hide()}),t(document).on("change","#recovery_url_coupon",function(){var e=t("#bwfan-merge-tag-settings").attr("merge-tag")+" ";e="{{"+e+("coupon='"+t(this).val()+"'")+"}}",t(".bwfan-preview-merge-tag").val(e)}),t(document).on("change",".bwfan_tag_input",function(){t(this).hasClass("recovery_url_coupon")||BWFAN_Actions.create_merge_tag_code()}),t(document).on("click",".bwfan-open-merge-tags-modal",function(){t(".bwfan-merge-tag-list").show(),t("#bwfan-merge-tag-settings").html("")}),t(document).on("click",".bwfan-use-merge-tag",function(){var e=t(".bwfan_form_merge_tags");if(!e[0].checkValidity())return e.find(":submit").click(),!1;var a=t(this).siblings(".bwfan-preview-merge-tag")[0];BWFAN_Actions.copy_merge_tag_code(a),t("#modal-show-merge-tags").iziModal("close")}),t(document).on("click",".bwfan_preview_email",function(){var e=t("#bwfan-actions-form-container").bwfan_serializeAndEncode();e=bwfan_deserialize_obj(e);var a=t(".bwfan-selected-action").attr("data-group-id"),n=e.bwfan[a];n.source=BWFAN_Auto.uiDataDetail.trigger.source,n.event=BWFAN_Auto.uiDataDetail.trigger.event,n._wpnonce=bwfanParams.ajax_nonce,n.automation_id=bwfan_automation_data.automation_id;var i=new bwf_ajax;i.ajax("show_email_preview",n),i.success=function(t){!0===t.status&&window.open(bwfanParams.admin_url+"admin.php?page=autonami-automations&section=preview_email&type=loaded&edit="+bwfan_automation_data.automation_id+"&noheader","preview_email","location=yes,height=800,width=800,scrollbars=yes,status=yes")}}),t(document).on("click","#bwfan_test_email_btn",function(){var e=t("#bwfan_test_email");if(""!==e.val()){var a=t(this);a.prop("disabled",!0),e.prop("disabled",!0);var n=e.val(),i=t("#bwfan-actions-form-container").bwfan_serializeAndEncode();i=bwfan_deserialize_obj(i);var o=t(".bwfan-selected-action").attr("data-group-id"),r=i.bwfan[o];r.source=BWFAN_Auto.uiDataDetail.trigger.source,r.event=BWFAN_Auto.uiDataDetail.trigger.event,r._wpnonce=bwfanParams.ajax_nonce,r.automation_id=bwfan_automation_data.automation_id,r.email=n;var s=new bwf_ajax;s.ajax("test_email",r),s.success=function(n){if(a.prop("disabled",!1),e.prop("disabled",!1),1==n.status){var i=t("#modal_automation_success");i.length>0&&(i.iziModal("setTitle",n.msg),i.iziModal("open"))}else swal({type:"error",title:window.bwfan.texts.sync_oops_title,text:n.msg})}}else e.addClass("bwfan_field_input_error")}),t(document).on("keyup","#bwfan_test_email",function(){var e=t(this);""===e.val()?e.addClass("bwfan_field_input_error"):e.hasClass("bwfan_field_input_error")&&e.removeClass("bwfan_field_input_error")}),t(document).on("click",".bwfan-show-timer-options",function(){t(this).parent().siblings(".bwfan-timer-options-container").slideToggle()}),t("body").on("click","span.bwfan-remove-repeater-field",function(e){e.preventDefault(),t(this).closest(".gs-repeater-fields").remove()}),t("body").on("click",".bwfan-repeater-ui",function(e){e.preventDefault();var a=t(this),n=Number(a.attr("data-count")),i=a.attr("data-groupid"),o=a.attr("data-repeater-slug"),r=wp.template("action-repeater-ui-"+o);try{a.parents(".bwfan-repeater-wrap").find(".bwfan-input-repeater").append(r({action_id:i,index:n,actionFieldsOptions:{}})),n+=1,a.attr("data-count",n)}catch(t){console.log("action-repeater-ui-"+o+" template not found")}})},create_event_ui:function(e){if(0!=t("#bwfan_events_output_div").length){var a=bwfan_automation_data.all_triggers,n=wp.template("bwfan-events-form-container");bwfan_make_html(1,".wr .wr_wrap_form",n);var i=wp.template("single-source");if(bwfan_make_html(1,"#bwfan-events-form",i({sources:a})),!0===e){if(Object.keys(a).length>0){var o=Object.keys(a);t(".bwfan-selected-source").val(o[0]),t(".bwfan-selected-source").trigger("change")}}else t(".bwfan-selected-source").val(BWFAN_Auto.uiDataDetail.trigger.source),t(".bwfan-selected-source").trigger("change")}},create_event_meta_ui:function(e){var a=wp.template("event-"+e);t(".bwfan-events-meta").html("");var n=bwfan_events_js_data[e];if(bwfan_make_html(1,".bwfan-events-meta",a({eventSavedData:BWFAN_Auto.uiDataDetail.trigger.event_meta,eventFieldsOptions:n})),t(".bwfan-select2ajax").length>0){var i=t(".bwfan-select2ajax").attr("data-search"),o=t(".bwfan-select2ajax").attr("data-search-text");BWFAN_Actions.initiate_select2_ajax(".bwfan-select2ajax",o,i)}if(t(".bwfan-tags").length>0&&this.initiate_select2(".bwfan-tags","Select",!0),t(".bwfan-single-select").length>0&&this.initiate_select2(".bwfan-single-select","Select",!1),t("#bwfan-editor").length>0){this.initiate_wysiwyg_editor("bwfan-editor")}},build_right_ui:function(e,a){var n=wp.template("bwfan-actions-form-container");bwfan_make_html(1,".wr .wr_wrap_form",n);var i=this.filter_events_actions(),o=BWFAN_Auto.getActionData(e,a),r="",s="";Object.keys(o).length>0&&(_.has(o,"integration_slug")&&!_.isEmpty(o.integration_slug)&&(r=o.integration_slug),_.has(o,"action_slug")&&!_.isEmpty(o.action_slug)&&(s=o.action_slug),_.isEmpty(s)&&_.has(o,"temp_action_slug")&&!_.isEmpty(o.temp_action_slug)&&(s=o.temp_action_slug)),_.isEmpty(r)&&!_.isEmpty(s)&&(r=window.bwfan_automation_data.int_actions[s]),_.isEmpty(s)?t("#bwfan-actions-form").attr("data-action","n"):t("#bwfan-actions-form").attr("data-action","y");var l=BWFAN_Auto.getSidebarTopTextArr("select_action");if(!1===_.isUndefined(BWFAN_Auto.uiDataDetail.actions[e])&&!1===_.isUndefined(BWFAN_Auto.uiDataDetail.actions[e][a])&&!1===_.isUndefined(BWFAN_Auto.uiDataDetail.actions[e][a].action_name)){var c=BWFAN_Auto.getActionDesc(r,s);l={head:BWFAN_Auto.uiDataDetail.actions[e][a].action_name,desc:c}}BWFAN_Auto.setSidebarTopText(l);var d=wp.template("single-action");bwfan_make_html(1,"#bwfan-actions-form",d({action_id:a,integration_slug:r,action_slug:s,all_actions:i})),BWFAN_Actions.build_action_ui(e,a,!1),t("#bwfan_group_id").val(e),t("#bwfan_action_id").val(a),t(".bwfan-action-submit-button").show()},filter_events_actions:function(){var e,a,n,i,o=window.bwfan_automation_data.actions_int,r=bwfan_automation_data.all_integrations,s=BWFAN_Auto.uiDataDetail.trigger.event,l=[],c=[];for(var _ in r)for(n in a=r[_]){var d=a[n];if(d.included_events.length){var u=d.included_events;-1===t.inArray(s,u)&&l.push(n)}else{var f=d.excluded_events;-1!==t.inArray(s,f)&&l.push(n)}}if(bwfan_events_included_actions[s].length)for(e=0;e<bwfan_events_included_actions[s].length;e++)c.push(bwfan_events_included_actions[s][e]);else if(bwfan_events_excluded_actions[s].length)for(e=0;e<bwfan_events_excluded_actions[s].length;e++)l.push(bwfan_events_excluded_actions[s][e]);if(o=JSON.stringify(o),o=JSON.parse(o),t.isArray(c)&&c.length>0)for(i in o)if(o.hasOwnProperty(i)){for(n in a=o[i])-1===t.inArray(n,c)&&delete o[i][n];a=o[i],0===Object.keys(a).length&&delete o[i]}if(t.isArray(l)&&l.length>0)for(i in o)if(o.hasOwnProperty(i)){for(n in a=o[i])-1!==t.inArray(n,l)&&delete o[i][n];a=o[i],0===Object.keys(a).length&&delete o[i]}if(Object.keys(bwfan_automation_data.pro_actions).length>0){var g=bwfan_automation_data.pro_actions;for(var m in g){var w=g[m];if(Object.keys(w).length>0)for(var b in!1===o.hasOwnProperty(m)&&(o[m]={}),w)o[m][b]={label:w[b],available:"no"}}}return o},get_action_name:function(t,e,a){var n="";if(""===e||""===a)return n;if("action"===t||"integration"===t||"action_text"===t){var i=bwfan_automation_data.all_integrations,o=bwfan_automation_data.all_automations,r=i[e][a].action_name,s=o[e].nice_name;"action_text"===t?n={integration:s,action:r}:"action"===t?n=r:"integration"===t&&(n=s)}else if("event"===t||"source"===t||"event_text"===t){var l=bwfan_automation_data.all_triggers,c=bwfan_automation_data.all_triggers_events,_=l[e].nice_name,d=c[e][a].event_name;"event_text"===t?n={integration:_,action:d}:"event"===t?n=d:"source"===t&&(n=_)}return n},get_event_desc:function(t,e){var a="";if(""===t||""===e)return a;var n=bwfan_automation_data.all_triggers_events;return!1===_.has(n,t)||!1===_.has(n[t],e)||!1===_.has(n[t][e],"event_desc")?a:a=n[t][e].event_desc},bwfan_set_events_new:function(e,a){if(t("#bwfan_events_output_div").length>0){var n;if(1==e)n=wp.template("single-event"),bwfan_make_html(1,"#bwfan-source-events",n({action_id:0,triggers_events:a}));else{var i=t(".bwfan-selected-source").val(),o=BWFAN_Auto.uiDataDetail.trigger.source,r=BWFAN_Auto.uiDataDetail.trigger.event;n=wp.template("single-event"),bwfan_make_html(1,"#bwfan-source-events",n({action_id:0,triggers_events:a})),i!=o?t(".bwfan-selected-trigger").val(""):t(".bwfan-selected-trigger").val(r),t(".bwfan-selected-trigger").trigger("change")}}},make_event_meta:function(){},build_action_ui:function(e,a,n){var i=BWFAN_Auto.getActionData(e,a);if(_.isUndefined(n)&&(n=!0),0!=_.size(_.keys(i))){var o,r="";if(_.isUndefined(i.action_slug)){if(_.isUndefined(i.temp_action_slug))return;r=i.temp_action_slug}else r=i.action_slug,!1===n&&(BWFAN_Auto.setActionFieldData(e,a,"temp_action_slug",null),i.temp_action_slug=null),!0!==n||_.isUndefined(i.temp_action_slug)||i.action_slug==i.temp_action_slug||(r=i.temp_action_slug);if(!_.isEmpty(r)){var s;if(t(".bwfan-form-inner .bwfan-show-merge-tags").css("display","block"),o=bwfan_set_actions_js_data[r],!(t("#tmpl-action-"+r).length>0))return s=wp.template("bwfan-no-action-found"),bwfan_make_html(1,".bwfan-fields-"+a,s()),void t("#bwfan-actions-form").attr("data-pro","n");if(s=wp.template("action-"+r),bwfan_make_html(1,".bwfan-fields-"+a,s({group_id:e,action_id:a,actionSavedData:i,actionFieldsOptions:o})),t("#bwfan-actions-form").removeAttr("data-pro"),t(".bwfan_add_tags_final_value").length>0&&t(".bwfan_add_tags_final_value").each(function(){var e=t(this),a=t(this).parents(".bwfan_add_tags").find(".tagchecklist"),n=e.attr("data-name"),o=_.has(i.data,n)?i.data[n]:[],l=_.has(bwfan_set_actions_js_data,r)?bwfan_set_actions_js_data[r].tags_options:[];_.size(o)>0&&(s=wp.template("bwfan-tags-cancel-ui"),a.html(s({tags:o,tagNames:l})),s=wp.template("bwfan-tags-select-html"),e.html(s({tags:o})))}),1==bwfan_automation_data.enable_lang){var l=bwfan_automation_data.all_triggers_events,c=BWFAN_Auto.uiDataDetail.trigger.source,d=BWFAN_Auto.uiDataDetail.trigger.event,u=bwfan_automation_data.all_integrations;if(_.isEmpty(integration_slug)&&(integration_slug=t("input[name='bwfan["+a+"][integration_slug]']").val()),!0===l[c][d].support_lang&&!0===u[integration_slug][r].support_language){s=wp.template("lang-support");var f={};void 0!==i.language&&(f=i.language),bwfan_make_html(1,".bwfan-lang-support-container",s({group_id:e,action_id:a,lang_options:bwfan_automation_data.lang_options,language:f}))}}s=wp.template("single-timer");var g={};void 0!==i.time&&(g=i.time),bwfan_make_html(1,".bwfan-timer-"+a,s({group_id:e,action_id:a,timerData:g})),s=wp.template("timer-display"),bwfan_make_html(1,".bwfan-time-container",s({group_id:e,action_id:a,timerData:g}));var m={};void 0!==i.action_priority&&(m={priority:i.action_priority});var w=wp.template("action-priority");if(bwfan_make_html(1,".bwfan-priority-"+a,w({group_id:e,action_id:a,priorityData:m})),t(".bwfan-select2ajax-single").length>0){var b=t(".bwfan-select2ajax-single").attr("data-search"),p=t(".bwfan-select2ajax-single").attr("data-search-text");this.initiate_select2_ajax_single(".bwfan-select2ajax-single",p,b)}if(t(".bwfan-tags").length>0&&this.initiate_select2(".bwfan-tags","Select",!0),t(".bwfan-single-select").length>0&&this.initiate_select2(".bwfan-single-select","Select",!1),t(".bwfan-tags-multiple").length>0&&this.initiate_select2_multiple(".bwfan-tags-multiple","Select",!1),t(".bwfan-datepicker").length>0&&this.initiate_datepicker(".bwfan-datepicker"),t("#bwfan-editor").length>0){this.initiate_wysiwyg_editor("bwfan-editor")}t(".bwfan_add_tags").length>0&&this.initiate_add_tag_ui(".bwfan_add_tags"),t("#bwfan_lang_support").length>0&&t("#bwfan_lang_support").on("click",function(){t(".bwfan_lang_support").toggleClass("bwfan-display-none")}),t(document).trigger("bwfan_after_action_ui_build",[e,a,i,o,g])}}},set_source_val:function(e){_.isUndefined(e)||_.isEmpty(e)||0!=t(".bwfan-selected-source").length&&t(".bwfan-selected-source").val(e)},create_merge_tag_code:function(){var e=t("#bwfan-merge-tag-settings").attr("merge-tag"),a="",n=t(".bwfan_form_merge_tags").bwfan_serializeAndEncode();for(var i in n=bwfan_deserialize_obj(n))""!==n[i]&&(a=a+" "+i+"='"+n[i]+"'");e="{{"+e+a+"}}",t(".bwfan-preview-merge-tag").val(e)},copy_merge_tag_code:function(e){var a,n,i,o="INPUT"===e.tagName||"TEXTAREA"===e.tagName;o?(i=e,a=e.selectionStart,n=e.selectionEnd):((i=document.getElementById("_hiddenCopyText_"))||((i=document.createElement("textarea")).style.position="absolute",i.style.left="-9999px",i.style.top="0",i.id="_hiddenCopyText_",document.body.appendChild(i)),i.textContent=e.textContent);var r,s=document.activeElement;i.focus(),i.setSelectionRange(0,i.value.length);try{r=document.execCommand("copy");var l=t("#modal_automation_success");l.length>0&&(l.iziModal("setTitle","Merge Tag Copied"),l.iziModal("open"))}catch(t){r=!1}return s&&"function"==typeof s.focus&&s.focus(),o?e.setSelectionRange(a,n):i.textContent="",r},initiate_wysiwyg_editor:function(e){var a=wp.oldEditor?wp.oldEditor:wp.editor;a.remove(e);var n=window.wpEditorL10n.tinymce.settings,i={resize:!1,wpautop:!1,height:400,setup:function(e){e.on("init",function(){window.richAutomationEditor=e}),e.on("change",function(){tinymce.triggerSave()}),e.addButton("bwfan_merge_tags_button",{text:"Merge Tags",icon:"bwf-merge-tag-icon",onclick:function(){t("#modal-show-merge-tags").iziModal("open")}}),e.addButton("bwfan_link-trigger_link_button",{text:"Link Triggers",icon:"bwf-link-trigger",onclick:function(){t("#modal-autonami-link-trigger-selector").iziModal("open")}})}},o=Object.assign(n,i);a.initialize(e,{tinymce:o,quicktags:!0,mediaButtons:!0})},initiate_add_tag_ui:function(e){t(e).on("click",".bwfan-tag-add",function(a){a.preventDefault();var n=t(this),i=n.parents(".bwfan_add_tags"),o=n.siblings("#new-tag-bwfan_tag").val();if(!_.isEmpty(o)){console.log("added tag "+o),n.siblings("#new-tag-bwfan_tag").val("");var r=i.find(".bwfan_add_tags_final_value").attr("data-action"),s=_.has(bwfan_set_actions_js_data,r)?bwfan_set_actions_js_data[r].tags_options:[],l=i.find(".bwfan_add_tags_final_value").val();if(l=_.size(l)>0?l:[],"-1"==_.indexOf(l,o)){"-1"!=_.indexOf(_.values(s),o)&&(o=_.findKey(s,function(t){return t==o})),l=_.union(l,[o]);var c=wp.template("bwfan-tags-select-html");t(e).find(".bwfan_add_tags_final_value").html(c({tags:l})),c=wp.template("bwfan-tags-cancel-ui"),t(e).find(".tagchecklist").html(c({tags:l,tagNames:s}))}}});var a,n=[];t.each(tags_options_clone,function(t,e){a={key:t,value:e},n.push(a)}),t("#new-tag-bwfan_tag").autocomplete({minLength:0,source:n,focus:function(){return t("#new-tag-bwfan_tag").val(""),!1},select:function(a,n){var i=t(e).find(".bwfan_add_tags_final_value").val();(i=_.size(i)>0?i:[]).push(n.item.key),i=_.uniq(i);var o=wp.template("bwfan-tags-select-html");t(e).find(".bwfan_add_tags_final_value").html(o({tags:i})),o=wp.template("bwfan-tags-cancel-ui");var r=t(e).find(".bwfan_add_tags_final_value").attr("data-action"),s=_.has(bwfan_set_actions_js_data,r)?bwfan_set_actions_js_data[r].tags_options:[];return t(e).find(".tagchecklist").html(o({tags:i,tagNames:s})),!1}}),t(e).on("click",".ntdelbutton",function(){var a=t(this).parents("li").attr("data-key"),n=t(e).find(".bwfan_add_tags_final_value").val(),i=_.without(n,a),o=wp.template("bwfan-tags-select-html");t(e).find(".bwfan_add_tags_final_value").html(o({tags:i})),o=wp.template("bwfan-tags-cancel-ui");var r=t(e).find(".bwfan_add_tags_final_value").attr("data-action"),s=_.has(bwfan_set_actions_js_data,r)?bwfan_set_actions_js_data[r].tags_options:[];t(e).find(".tagchecklist").html(o({tags:i,tagNames:s}))})},initiate_select2:function(e,a,n){var i={placeholder:a,tags:n,createTag:function(t){return{id:t.term,text:t.term,tag:!0}},select:function(t){console.log(t)}};t(e).select2(i)},initiate_select2_multiple:function(e,a,n){var i={placeholder:a,multiple:!0,tags:n,select:function(t){console.log(t)}};t(e).select2(i)},initiate_datepicker:function(e){t(e).datepicker({dateFormat:"yy-mm-dd"})},initiate_select2_ajax:function(e,a,n,i){var o="";try{""!=t(e).parents("tr.bwfan-rule").find("select.rule_type").val()&&(o=t(e).parents("tr.bwfan-rule").find("select.rule_type").val())}catch(t){}var r={placeholder:a,minimumInputLength:2,multiple:!0,tags:!1,data:void 0!==bwfan_select2_ajax_data[n]?this.convert_array_to_obj(bwfan_select2_ajax_data[n]):[],escapeMarkup:function(t){return t},ajax:{url:ajaxurl,dataType:"json",type:"POST",delay:250,data:function(t){return{search_term:t,action:"bwf_select2ajax",type:n,ruletype:o,_wpnonce:bwfanParams.ajax_nonce}},processResults:function(a){return BWFAN_Actions.fill_select2_ajax_data(n,a),t(document).trigger("select2ajaxdataRecieved",[e,n,a]),{results:a.results}}}};void 0!==i?t(e).select2(r).val(i).trigger("change"):t(e).select2(r)},initiate_select2_ajax_single:function(e,a,n,i){var o="";try{""!=t(e).parents("tr.bwfan-rule").find("select.rule_type").val()&&(o=t(e).parents("tr.bwfan-rule").find("select.rule_type").val())}catch(t){}var r={placeholder:a,minimumInputLength:2,tags:!1,data:void 0!==bwfan_select2_ajax_data[n]?this.convert_array_to_obj(bwfan_select2_ajax_data[n]):[],escapeMarkup:function(t){return t},ajax:{url:ajaxurl,dataType:"json",type:"POST",delay:250,data:function(t){return{search_term:t,action:"bwf_select2ajax",type:n,ruletype:o,_wpnonce:bwfanParams.ajax_nonce}},processResults:function(a){return t(document).trigger("select2ajaxdataRecieved",[e,n,a]),BWFAN_Actions.fill_select2_ajax_data(n,a),t(e).trigger("change"),{results:a.results}}},templateSelection:function(t){return _.has(bwfan_select2_ajax_data,"coupon")&&_.has(bwfan_select2_ajax_data.coupon,t.id)?bwfan_select2_ajax_data.coupon[t.id]:t.text}};void 0!==i?t(e).select2(r).val(i).trigger("change"):t(e).select2(r)},fill_select2_ajax_data:function(e,a){!1===_.isUndefined(BWFAN_Auto.uiDataDetail.trigger.event)?!0===_.isUndefined(bwfan_select2_ajax_data[e])?bwfan_select2_ajax_data[e]={}:"string"==typeof bwfan_select2_ajax_data[e]&&(bwfan_select2_ajax_data[e]=JSON.parse(bwfan_select2_ajax_data[e])):!1===_.isUndefined(bwfan_select2_ajax_data[e])?(t.isEmptyObject(bwfan_select2_ajax_data[e])||"[]"==bwfan_select2_ajax_data[e])&&(bwfan_select2_ajax_data[e]={}):bwfan_select2_ajax_data[e]={},t.map(a,function(a){t(a).each(function(t,a){bwfan_select2_ajax_data[e][a.id]=a.text})})},make_merge_tag_ui:function(e,a){var n={};if(0!==t("#bwfan-section-merge-tags").length&&(t.each(a,function(t,e){n[t]=e}),!_.isEmpty(n))){var i=wp.template("section-merge-tags");t("#bwfan-section-merge-tags").html(""),bwfan_make_html(1,"#bwfan-section-merge-tags",i({merge_tags:n}))}},create_execution_delay_time_ui:function(t){var e=t.parents("form"),a=e.find("input#bwfan_action_id").val(),n=e.find('input[name="bwfan['+a+'][time][delay_type]"]').length>0?e.find('input[name="bwfan['+a+'][time][delay_type]"]:checked').val():"immediately",i=e.find("#bwfan_time_number_"+a).val(),o=e.find("#bwfan_delay_mode_"+a).val(),r=e.find("#bwfan_fixed_date_"+a).val(),s=e.find("#bwfan_fixed_time_"+a).val(),l=wp.template("timer-display");bwfan_make_html(1,".bwfan-time-container",l({action_id:a,timerData:{delay_type:n,time_number:i,time_type:o,fixed_date:r,fixed_time:s}}))},validate_merge_tags_syntax:function(t){var e=!0;if("-1"==t.indexOf("{{")&&"-1"==t.indexOf("}}"))return e;var a=t.match(/{{/gi),n=t.match(/}}/gi);return null!=a&&null!=n&&((a=a.length)!==(n=n.length)&&(e=!1),e)},validate_checkboxes:function(e){var a=!1,n=[],i=[];for(var o in t(e).each(function(){var e=t(this).attr("name"),a=t(this).attr("data-warning");n.push(e),i.push(a)}),t.unique(n),t.unique(i),n)if(0==t('[name="'+n[o]+'"]:checked').length)return swal({type:"error",title:window.bwfan.texts.sync_oops_title,text:i[o]}),a=!0,!1;return!a||(console.log("checkbox not checked"),!1)},get_group_action_id_action_ui:function(t,e){if(0==t.parents("#bwfan-actions-form-container").length)return"";var a=t.parents("#bwfan-actions-form-container"),n=a.find("#bwfan_group_id").val(),i=a.find("#bwfan_action_id").val();return"group_id"==e?n:"action_id"==e?i:void 0},recreate_action_ui_ajax:function(e,a,n){var i=this.get_group_action_id_action_ui(e,"group_id"),o=this.get_group_action_id_action_ui(e,"action_id");Object.keys(a).length>0&&t.each(a,function(t,e){""!=t&&BWFAN_Auto.setActionFieldInnerData(i,o,t,e)}),Object.keys(n).length>0&&t.each(n,function(t,e){""!=t&&BWFAN_Auto.setActionFieldAjaxData(i,o,t,e)}),BWFAN_Actions.build_action_ui(i,o,!1)},convert_array_to_obj:function(t){var e=[];for(var a in t)e.push({id:a,text:t[a]});return e},make_automation_track_id:function(){var e=t(".bwfan-manage-automation-form").find("input[name=a_track_id]").val();e=_.isEmpty(e)?0:parseInt(e),e+=1,t(".bwfan-manage-automation-form").find("input[name=a_track_id]").val(e)},get_action_timer_ui:function(t){var e=_.has(t,"delay_type")?t.delay_type:"",a=_.has(t,"time_number")?t.time_number:"",n=_.has(t,"time_type")?t.time_type:"",i=_.has(t,"fixed_date")?t.fixed_date:"",o=_.has(t,"fixed_time")?t.fixed_time:"",r="";return"after_delay"===e?r=a+" "+n:"fixed"===e?r="on "+i+" at "+o:"schedule_with_variable"===e&&(r="with scheduled variable"),r}}).init(),t.fn.bwfan_serializeAndEncode=function(){return t.map(this.serializeArray(),function(t){return[t.name,encodeURIComponent(t.value)].join("=")}).join("&")}}(jQuery);