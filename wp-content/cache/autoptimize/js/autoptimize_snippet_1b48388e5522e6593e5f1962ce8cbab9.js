(function($){'use strict';jQuery(document).ready(function(){var timer;function showExitIntentForm(event){var currentTime=new Date().getTime();var timePeriod=cartbounty_ei.hours;var last_time_displayed=localStorage.getItem('cartbounty_ei_last_time');var productCount=cartbounty_ei.product_count;if(event.clientY<=0&&event.target.tagName.toLowerCase()!="select"&&event.target.tagName.toLowerCase()!="option"&&event.target.tagName.toLowerCase()!="input"){if(productCount==0){}
else if(last_time_displayed==null||timePeriod==0){$('#cartbounty-exit-intent-form').addClass('cartbounty-visible');$('#cartbounty-exit-intent-form-backdrop').css('opacity','').addClass('cartbounty-visible');if(timePeriod!=0){localStorage.setItem('cartbounty_ei_last_time',currentTime);}}else{if(currentTime-last_time_displayed>timePeriod*60*60*1000){localStorage.removeItem('cartbounty_ei_last_time');}}}}
function getExitIntentEmail(){var cartbounty_email=jQuery("#cartbounty-exit-intent-email").val();var atposition=cartbounty_email.indexOf("@");var dotposition=cartbounty_email.lastIndexOf(".");clearTimeout(timer);if(!(atposition<1||dotposition<atposition+2||dotposition+2>=cartbounty_email.length)){var data={action:"cartbounty_save",cartbounty_email:cartbounty_email}
timer=setTimeout(function(){jQuery.post(cartbounty_ei.ajaxurl,data,function(response){});},800);}else{}}
function insertExitIntentForm(){var data={action:"insert_exit_intent",cartbounty_insert:true}
if($('#cartbounty-exit-intent-form').length<=0){jQuery.post(cartbounty_ei.ajaxurl,data,function(response){var output=response;$("body").append(output);jQuery("#cartbounty-exit-intent-email").on("keyup keypress change",getExitIntentEmail);jQuery("#cartbounty-exit-intent-close, #cartbounty-exit-intent-form-backdrop").on("click",closeExitIntentForm);});}
cartbounty_ei.product_count=parseInt(cartbounty_ei.product_count)+1;}
function removeExitIntentFormIfEmptyCart(){var data={action:"remove_exit_intent",cartbounty_remove:true}
if($('#cartbounty-exit-intent-form').length>0){jQuery.post(cartbounty_ei.ajaxurl,data,function(response){if(response.data=='true'){$('#cartbounty-exit-intent-form').remove();$('#cartbounty-exit-intent-form-backdrop').remove();}});}}
function closeExitIntentForm(){$('#cartbounty-exit-intent-form').removeClass('cartbounty-visible');$('#cartbounty-exit-intent-form-backdrop').removeClass('cartbounty-visible');}
jQuery(document).on("mouseleave",showExitIntentForm);jQuery("#cartbounty-exit-intent-email").on("keyup keypress change",getExitIntentEmail);jQuery("#cartbounty-exit-intent-close, #cartbounty-exit-intent-form-backdrop").on("click",closeExitIntentForm);jQuery(document).on("added_to_cart",insertExitIntentForm);jQuery(document).on("removed_from_cart",removeExitIntentFormIfEmptyCart);});})(jQuery);